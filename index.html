<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta name="description" content="CrmUp : CrmUp is an extension to DbUp that helps you to deploy changes to Microsoft Dynamics Crm in a Continuos manner." />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Crmup</title>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49278315-2', 'dazinator.github.io');
  ga('send', 'pageview');

</script>
</head>

<body>


    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
            <a id="forkme_banner" href="https://github.com/dazinator/CrmUp">View on GitHub</a>

            <h1 id="project_title">CrmUp</h1>
            <h2 id="project_tagline">CrmUp is a .NET library that helps you to automate the deployment of your Microsoft Dynamics Crm customisations. 
              
            </h2>

            <section id="Section1">
                <a class="zip_download_link" href="https://github.com/dazinator/CrmUp/zipball/master">Download this project as a .zip file</a>
                <a class="tar_download_link" href="https://github.com/dazinator/CrmUp/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>


    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
        <section id="Section2" class="inner">

            <!--                 <h2>Repeatable Dynamics Crm deployments?</h2>
            <p>
                Coming up with a repeatable and automated deployment procedure for rolling out your latest Dynamics Crm changes / customisations accross environments such as Dev, UAT, Production is something that teams / organisations can often struggle with. 
                    It can be a complex issue, and there are various <a href="http://www.microsoft.com/en-gb/download/details.aspx?id=27824">white papers</a> regarding this topic. 
                    Many organisations end up resorting to procedures that are not repeatable, and require adhoc manual tasks to be performed from deployment to deployment. For example, one release may involve Mary having to manually apply a solution file to the UAT environment. The next release may involve Brian having to manually apply a solution file, or perhaps register a plugin or workflow on a Production environment.
                    This manual ("Mary Brian"?) approach can quickly lead to headaches. Here are some of the problems this can introduce:-                 
            </p>
            <ul>
                <li>Manual deployment procedures can take a large amount of person-hours from your organisation. Wouldn't you rather put that time to better use on things that actually add value?</li>
                <li>Manual deployment procedures can invite mistakes. Environments can quickly become out of line, negating your confidence in the stability of that environment, and intrthose envrionments when they can no longer fulfill the purpose they are maintained for.</li>
                <li>It's harder to quickly "spin up" a development or test envrionemnt as manual hoops have to be jumped through.</li>
                <li>It becomes easy to impose detrimental constraints upon the design of your solution in order to facilitate the need for an easy manual deployment process. For example, sometimes organisations may be scared to move a field in Crm from one location to another 
                        even though the overall solution would benefit from the change, and the reason may be because doing so would introduce an element of data migration to migrate existing data and without a way to automate this, it becomes a potentially dangerous and time consuming activity for the person who does the deployment. </li>
            </ul>
            <p>Ultimately, The length of projects can be long, and when you are constantly delivering changes, having an auotomated and repeatable deployment procedure is going to pay dividends.</p>-->
            <h2>Deploying things to Dynamics Crm?</h2>         
            
            <p>
                <ul>
                    <li>Frustrated of manually applying Solution Files or registering workflows?</li>
                    <li>Has a plugin been registered on Production but not in UAT?</li>
                    <li>Do you value your time?</li>
                </ul>               

                <strong><em>Never manually deploy anything to Dynamics CRM ever again.</em></strong>              
                    
            </p>
             <p>
                  CrmUp will help you to reach that nirvana known as &quot;Continuous Delivery Land&quot;.
                  CrmUp will apply all necessary changes (from your release) for you, essentially rolling up the target Dynamics Crm from its previous version to the version in your release.
                  CrmUp will apply the things that you give it:-
              </p>            
            <ul>
                <li>Dynamics Crm Solution files.</li>
                <li>Code based activities / migrations.</li>
            </ul>
            <p>
                <b>&quot;Dynamics Crm Solution&quot; files</b> should be familiar to anyone who works with customising Dynamics Crm, and they effectively contain customisations to apply.
                    <br>
                <b>Code based migrations</b> are methods that can be written by you (the developer) in order to perform an activity that would otherwise have to be achieved manually. There are many such activities of this nature that can be automated through code. Many are mentioned in the <a href="http://www.microsoft.com/en-gb/download/details.aspx?id=27824">white paper</a> such as importing some intial reference / configurational data into Dynamics for example, or un-registering a plugin etc.
             
            </p>
             <h2>This library has roots..</h2>
            <p>At the heart of CrmUp lies <a href="http://dbup.github.io/">DbUp</a>, and CrmUp is an extension for <a href="http://dbup.github.io/">DbUp </a>that brings <a href="http://dbup.github.io/">DbUp's </a>philosophy to the realm of Microsoft Dynamics Crm.</p>
            <br />

            <h2>Getting Started</h2>
            <p>Start by creating a simple C# console project in Visual Studio, and adding your Crm Solution files to it. From the properties window, mark them as Embedded Resources:</p>

            <img src="images/add-solutions.png" alt="CrmUp Sample">

              <p>Under your project properties, make sure to set the Target Framework to either .NET 4.0 or .NET 4.5:</p>

            <img src="images/TargetNET40.png" alt="CrmUp Sample">

            <p>Next, use NuGet to install the CrmUp package:</p>

            <pre><code>Install-Package CrmUp</code></pre>           

            <p>Finally, in <code>Program.cs</code>, add the following code:</p>

            <pre><code>
        static int Main(string[] args)
        {
            var connectionString = args.FirstOrDefault() 
                ?? "Url=http://crmurl:5555/orgname;Domain=domain; UserName=admin; Password=pasword;Timeout=00:15:00;";
            var upgrader =
               DeployChanges.To
                            .DynamicsCrmOrganisation(connectionString)
                            .WithSolutionsEmbeddedInAssembly(Assembly.GetExecutingAssembly())
                            .LogToConsole()
                            .Build();

            var result = upgrader.PerformUpgrade();

            if (!result.Successful)
            {

                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine(result.Error);
                Console.ResetColor();
                return -1;
            }

            Console.ForegroundColor = ConsoleColor.Green;
            Console.WriteLine("Success!");
            Console.ResetColor();
            return 0;

        }
}
</code></pre>

            <p>You now have a console application that will apply your Crm Solution files to a Dynamics Crm system in order to roll it up to the latest version! After running it, you'll see something like this:</p>

            <img src="images/scripts-ran.png" alt="First run - the scripts get executed">

            <p>The next time you run it, you'll see:</p>

            <img src="images/scripts-noneran.png" alt="Second run - the scripts have already been executed">

            <h2>Why a console application?</h2>
            <p>
                For many reasons, all of which are mentioned over on <a href="http://dbup.github.io/">DbUp's documentation </a>, but I will list them again here (copied from their site):
                        
                        <blockquote cite="http://dbup.github.io/">
                            By putting your migration scripts in an executable that can be run, you'll get a lot of benefits:
                            <ul>
                                <li>You can hit F5 at any time to test the migration scripts</li>
                                <li>Other developers on your team can do the same</li>
                                <li>You can execute them as part of an automated deployment</li>
                                <li>You can run it during your integration tests</li>
                                <li>Since it's in your VS solution, it will go into source control along with the rest of your code</li>
                                <li>Alternatively, instead of a console application, you can create a class library that references DbUp, and embed it into a maintenance screen inside your application.</li>

                            </ul>

                        </blockquote>
            </p>
            <h2>Journaling</h2>
            <p>
                CrmUp creates a new entity in Crm, called "CrmUp Journal", and this is used to track the change scripts
                        that have been applied to the system. Before running, CrmUp checks the Journal records to work out which change scripts can be skipped. After applying a change script, an appropriate journal record is created to record the change that has been applied. If you ever want to know what Migrations have been applied to Dynamics CRM, you can query this entity.
            </p>
             <img src="images/schema-versions.png" alt="The Journal created by CrmUp">
             <h2>Organisation Creation?</h2>
             <p>
                CrmUp can even automatically create the Dynamics Crm organisation for you if it doesn't allready exist:-
                <pre><code>
                    sample code to come..     
               </code></pre>
            </p>
            <h2>Code based Migrations?</h2>
             <p>
                You can write code based migrations to perform code based deployment activities that you need. This is similar in concept to EF "Code-First" Migrations. 
                Your migrations are executed by CrmUp in alphabetical order by their "ScriptName". If the migration has already been successfully run against the CRM
                in the environment then it will not be run a second time. Only the migrations that need to be run will be executed by CrmUp.
                You can create a code based migration by simply inheriting from a particular abstract class like so:
                <pre><code>
    public class ImportCurrencies : CrmCodeMigration
    {

        public override string ScriptName
        {
            get { return "0001" + this.GetType().Name; }
        }

        public override void Up(ICrmServiceProvider serviceProvider, IUpgradeLog log)
        {
            var service = serviceProvider.GetOrganisationService();
            // Do any thing you like as part of this code based migration here..

            // As long as you don't throw an exception, the migration will be record in the crm             // journal table as successfully run.

        }

       
    }  
               </code></pre>
               
                 The ScriptName property allows you to give a name to your migration. Your migrations are run in alphabetical order so you will likely want to inplement a numbering strategy here.
                 CrmUp will invoke each migration that needs to be run in alphabetical order, and will call the "Up()" method, passing in instances of the Crm Services - ready for you to perform your actons in Crm.
                 Your migrations have easy access to the Dynamics Crm Organisation service, Discovery Service, and Deployment Service. You can use this mechanism to perform deployment tasks such as 
                 registering a plugin, importing data, un-registering plugin or workflows, moving reference data from an obsolete field etc etc.
            </p>
            <h2>Resources</h2>
            <p>
                The source code for CrmUp is all on <a href="https://github.com/dazinator/CrmUp">GitHub</a>. Any issues can also be raised there.
            </p>

        </section>
    </div>
    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
        <footer class="inner">
            <p class="copyright">CrmUp is maintained by <a href="https://github.com/dazinator">Darrell Tunnell</a></p>
            <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
        </footer>
    </div>
</body>
</html>
